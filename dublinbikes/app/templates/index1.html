<html>

<head>
    <link rel=stylesheet type="text/css" href="{{ url_for('static',filename='styles/style.css') }}" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <title>{{ title }} - Dublin Bikes</title>
</head>

<body>
    <!--<div id="test"></div>

    <div id="bikepic"><img src="images/bikes.jpg" alt="bike_picture"/></div>
    <div id="jsdata"></div>-->
    <div id="header">
        <h1>Real-time Dublin Bike Information</h1>
        <img src = "https://vignette.wikia.nocookie.net/logopedia/images/7/74/Dublinbikes.svg/revision/latest?cb=20140625224430" style = "width:100px;height:55px;position:fixed;right:20%;top:0px;">
    </div>

    <div style="background-color: rgba(255,255,255,0.7);width:1000px;height: 100%; margin: auto;">
<!--        <div id = "centerblock">-->
        <div id="googleMap"></div>
        
        <div id="dailyDiv">
            <h2 id="todayDate">Todays date</h2>
            <img src="http://openweathermap.org/img/w/04d.png" style = "float: left;margin-left: 15px;">
            <em>9°C</em><br/><br/><br/><br/><br/><br/>Rain<br/><br/><b>Min: </b>7°C<br/><b>Max:  </b>10°C<br/><br/>Moderate Rain
            
        </div>

    <div id="dataframeDiv"></div>
    <div id="jsdata"></div>

    <script type=text/javascript>
    	$SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
    </script>

    <script>infoArray = [];</script>

    <script>function getDataFrame () {
        var jqdataframe = $.getJSON($SCRIPT_ROOT + "/dataframe/1", function(data) {
            var df = data.df;
            console.log(df);
            //console.log(bikes);
            console.log(typeof df);
            console.log("dataframe chunk above")
            document.getElementById("dataframeDiv").innerHTML = bikes;
        })
    }
    </script>

    <script>getDataFrame();</script>

    <script>
        function myMap() {
        	var jqxhr = $.getJSON($SCRIPT_ROOT + "/stations", function(data) {
				var stations = data.stations;

				console.log("stations", stations);

                

				//draw markers
				stations.forEach(function(stations) {
                    var markerIcon = "/static/bikeicon.png";

                    var totalStands = stations.bikes_available + stations.stands_available;
                    console.log(totalStands);

                    console.log(stations.bikes_available < (2 * totalStands / 3));

                    if (stations.bikes_available >= (totalStands / 3) && stations.bikes_available <= (2 * totalStands / 3)) {
                        markerIcon = "/static/bikeicon-orange.png";
                    } else if (stations.bikes_available < (totalStands / 3)) {
                        markerIcon = "/static/bikeicon-red.png";
                    }


					var marker = new google.maps.Marker({
						position : {
							lat : stations.latitude,
							lng : stations.longitude
						},
					map : map,
					title : stations.name,
					station_number : stations.number,
                    icon : markerIcon,
                    //animation: google.maps.Animation.BOUNCE
					});				

					google.maps.event.addListener(marker, 'click', function() {
                        for (var i=0;i<infoArray.length;i++) {
                            infoArray[i].close();
                        }
                        var infowindow = new google.maps.InfoWindow();
                        infoArray.push(infowindow);

						contentString = '<div id = "content"><h1>' + stations.name + '</h1></div>' + '<div id="station_availability"><h1>Bikes available: ' + stations.bikes_available + '<br> Stands available: ' + stations.stands_available + '</h1></div>';
						infowindow.setContent(contentString);
						infowindow.open(map, marker);

                        //document.getElementById("jsdata").innerHTML = stations.bikes_available;
					});
				})
			})
            

            var jqweather = $.getJSON($SCRIPT_ROOT + "/weather", function(data) {
                var weatherInfo = data.weatherInfo;
                console.log(weatherInfo);
                var actualTemp = weatherInfo.temp - 273.15; //turning kelvin temp to actual temp in degrees celsius
                actualTemp = (actualTemp).toFixed(1) //rounding to 1 decimal place

                var iconCode = weatherInfo.icon;
                console.log(typeof(iconCode));
                var icon = "http://openweathermap.org/img/w/" + iconCode + ".png";

                document.getElementById("jsdata").innerHTML = "<h2>The forecast is: " + weatherInfo.detail + "<br>The temperature is: " + actualTemp + "</h2>" + 
                "<img src=" + icon + ">";
                

            })

            var myLatLng = {
                lat: 53.349976,
                lng: -6.260354
            };
            var mapProp = {
                center: new google.maps.LatLng(53.349976, -6.260354),
                zoom: 13,
            };
            var map = new google.maps.Map(document.getElementById("googleMap"), mapProp);
        }
        google.maps.event.addDomListener(window, 'load', myMap);
    </script>



    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAMns2Y33xj53IYHDDwQQb5P-R2mi5nxQk&callback=myMap"></script>

</body>

</html>